(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[15],{1024:function(e,t,r){"use strict";r.d(t,"b",(function(){return U})),r.d(t,"a",(function(){return v}));var s=r(544),o=r(260),i=r(12);const n=function(e){if(e.name){const t=e.name,r=(Math.max(0,t.lastIndexOf("."))||1/0)+1;let s=t.substr(r);return""==s?s:(s=s.replace(/\?.*$/,""),/[^a-zA-Z0-9]/.exec(s)?"":s.toLowerCase())}if(e.type){const[t,r]=e.type.split(";"),[s,o]=t.split("+"),[i,n]=t.split("/");return n?n.toLowerCase():""}return""};var a;!function(e){e[e.UploadCompletedOK=200]="UploadCompletedOK",e[e.UploadCompletedCREATED=201]="UploadCompletedCREATED",e[e.Resume=308]="Resume",e[e.SessionExpired=400]="SessionExpired",e[e.Restart=404]="Restart",e[e.RequestTimeout=408]="RequestTimeout",e[e.ServerError=500]="ServerError",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout"}(a||(a={}));class l extends Error{constructor(e,t){super(e),this.gcsError=t}}const c=(e,t,r)=>{if(!["completion","error","progress"].includes(t))throw new Error("Invalid event: "+t);return e.listeners[t]=r,e},p=async(e,t)=>{const r=Math.floor(999*Math.random())+1,s=Math.min(2**e*1e3+r,t);return new Promise(e=>{console.log(`Backing off for ${s} ms`),setTimeout(()=>{e()},s)})},u=(e,t)=>{const{listeners:{error:r}}=e;r&&r(e,t)},d=(e,t)=>{const{listeners:{progress:r}}=e;r&&r(e,t)},h=(e,t)=>{const{file:r}=e,s=r.size,{status:o,headers:i}=t;if(o===a.Resume){const e=i.get("Content-Range")||i.get("Range");if(e){const[t,r]=(e=>{const t=/^bytes=(\d+)-(\d+)$/.exec(e);if(t)return[parseInt(t[1],10),parseInt(t[2],10)];throw new Error("Dont recognize this format of content range: "+e)})(e);return{lastByteUploaded:r,isSuccess:!0}}return{isSuccess:!1,gcsError:"RETRY"}}if(o===a.UploadCompletedOK||o===a.UploadCompletedCREATED){return{lastByteUploaded:s-1,isSuccess:!0}}if(o===a.Restart)return{lastByteUploaded:-1,status:o,gcsError:"START_FROM_BEGINNING",isSuccess:!1};if(o===a.SessionExpired)return{isSuccess:!1,status:o,gcsError:"SESSION_EXPIRED"};return o===a.ServerError||o===a.ServiceUnavailable?{isSuccess:!1,status:o,gcsError:"QUERY_AND_RETRY"}:{isSuccess:!1,status:o,gcsError:"RETRY"}},f=async e=>{const{resumableSessionUri:t,file:r,abortController:s}=e,{signal:o}=s,i={"Content-Range":"bytes */"+r.size,"Content-Length":"0"},n=await fetch(t,{method:"PUT",headers:i,mode:"cors",signal:o});return h(e,n)},m=async(e,t,r)=>{const{resumableSessionUri:s,file:o,abortController:i,hardFileSizeLimit:n}=e,{signal:a}=i,l=o.size,c=r+t.size-1,p={"Content-Type":o.type,"Content-Length":t.size.toString(),"Content-Range":`bytes ${r}-${c}/${l}`};n&&(p["X-Upload-Content-Length"]=l);const u=await fetch(s,{method:"PUT",mode:"cors",headers:p,body:t,signal:a});return h(e,u)},b=(e,t,r)=>{const s=e-t-1;return s>=2*r?r:s},g=(e,t)=>t===e-1,y=async e=>{const{file:t}=e,r=t.size;let s=-1,o=0,i=0,n=null,a=0;const c=Math.max(5,Math.ceil(r/2097152*1.6));for(;a<=c;a++){const a=b(r,s,2097152),c=t.slice(o,o+a);try{const{isSuccess:t,lastByteUploaded:a,gcsError:l}=await m(e,c,o);if(t)a&&(s=a),o=s+1,d(e,(s+1)/r),i=0;else{if("START_FROM_BEGINNING"===l&&(s=-1),"SESSION_EXPIRED"===l){const t=new Error("Session expired");return void u(e,t)}if("QUERY_AND_RETRY"===l){const{lastByteUploaded:t}=await f(e);t&&(s=t,o=s+1),d(e,(s+1)/r)}await p(i,32e3),i+=1}n=null}catch(h){if("AbortError"===h.name)break;console.error(h);if(i>=2&&-1===s){n=new l("No progress with upload","LIKELY_BLOCKED");break}n=h,await p(i,32e3),i+=1}if(g(r,s))break;if(e.cancelled)break}if(n||a>=c){const t=n||new Error(`Exceeded ${c} requests to upload`);console.error(t),u(e,t)}g(r,s)&&(e=>{const{listeners:{completion:t}}=e;t&&t(e)})(e)};var _=r(69),j=r(1081),S=r.n(j);r(1082);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const v="FILE_TOO_LARGE_ERROR",w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)("Uploads","Error",e),t.fileType=e,Object(i.c)("UploadError",{context:t})},E=function(e){Object(o.a)("Uploads","Success",e)};class U extends S.a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.file=e,this.options=t}maxFileSize(){return this.options.maxFileSize?this.options.maxFileSize+1048576:this.options.maxFileSize}cancel(){this.xhr1&&this.xhr1.abort(),this.xhr2&&this.xhr2.abort(),this.resumableUpload&&(e=>{const{abortController:t,resumableSessionUri:r,file:s}=e;t.abort(),e.cancelled=!0})(this.resumableUpload),this.completionXhr&&this.completionXhr.abort(),this.emit("cancel")}perform(){const e=this.maxFileSize();var t;e&&this.file.size>e?(Object(o.a)("Uploads","Large file",this.file.type,this.file.size),this._reject({error:v})):(t=this.file,new Promise((e,r)=>{const s=n(t);if(/gdoc|gsheet|glink|gform|gmap|gmaps|gslides|gdraw|url|htm|html|webloc|mht|mhtml/.exec(s)){let o;const i=new FileReader;i.onload=()=>{const t="string"!==typeof i.result?"":i.result;if(""===t||"gdoc"!==s&&"gsheet"!==s&&"glink"!==s&&"gform"!==s&&"gmap"!==s&&"gmaps"!==s&&"gslides"!==s&&"gdraw"!==s)"url"===s&&(o=/URL=(.*)/.exec(t))||("htm"===s||"html"===s)&&t.includes("window.googleJavaScriptRedirect")&&(o=/content="0;URL='(.*)'/.exec(t))?e({url:o[1]}):"htm"!==s&&"html"!==s||!(o=/<!--ssavedsfromsurl=((?:d+))(.*?)s-->/.exec(t))||"http://tiddlywiki.com"===o[1]?"webloc"===s&&(o=/<string>(.*)<\/string>/.exec(t))?e({url:o[1]}):"mht"!==s&&"mhtml"!==s||!(o=/Content-Location:s(.*)/.exec(t))?r():e({url:o[1]}):e({url:o[1]});else{const r=JSON.parse(t);e({url:r.url})}},i.onerror=()=>{r()},i.readAsText(t)}else r()})).then(this._resolve.bind(this),this._ajax1.bind(this,this._useResumable()))}_progress(e,t){const r=e.loaded/e.total;this.emit("progress",r)}_useResumable(){return!!window&&"undefined"!==typeof window.AbortController}_resolve(e){this.emit("done",e)}_reject(e){this.emit("error",e)}_ajax1(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this;this.xhr1=Object(s.a)({url:"/media/upload_attributes.json",dataType:"json",type:"GET",cache:!1,sendOauthToken:!0,data:{unique:+new Date,fileSize:t.file.size,filename:t.file.name,contentType:t.file.type,resumable:e,maxFileSize:this.maxFileSize()},error(e,r){"abort"!=r&&(w("ajax1",{statusCode:e.status,readyState:e.readyState}),t._reject(e))},success(e){e.resumable?t._resumable(e):t._ajax2(e)}})}_ajax2(e){const t=new Date,r=this,o=new FormData,i=function(e){const t=n(e);if(e.name){const r=e.name.split(".");r.pop();let s=r.join("_");return s=s.replace(/[^a-zA-Z0-9_]/g,"_"),s=s.substr(0,100),t?[s,t].join("."):s}return t?"file."+t:"file"}(this.file),a=this.file.name?this.file.name:i,l={};this.options.maxFileSize&&(l.max_file_size=this.options.maxFileSize+1048576,l.transcode=!0);const c=Object.assign({},e.fields,l);Object.entries(c).forEach(e=>{"key"!=e[0]&&o.append(e[0],e[1])}),o.append("key",[e.fields.key,i].join("/")),o.append("Content-Type",this.file.type),o.append("file_size",this.file.size),o.append("title",a),o.append("file",this.file,i),this.xhr2=Object(s.a)({url:e.url,crossDomain:!0,type:"POST",data:o,cache:!1,contentType:!1,processData:!1,dataType:"json",xhr(){const e=_.a.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",e=>{e.lengthComputable&&r._progress(e,t)}),e},error(e,t){"abort"!=t&&(w(r.file.type,{statusCode:e.status,userId:c.uploader_id,filename:r.file.name,filsSize:r.file.size,maxFileSize:c.max_file_size||"None",resuamble:!1,readyState:e.readyState,responseText:e.responseText,responseXml:e.responseXml}),r._reject(e))},success(e){E(r.file.type),r._resolve(e)}})}_resumable(e){const t=new Date,r=this,s=r.file,o=e.fields,i=o.completion_url,n=e=>{w(s.type,{action:"gcsResumableUpload",message:e.message,type:"GCS Resumable Upload",fileSize:s.size,filename:s.name,userId:o.uploader_id,maxFileSize:o.max_file_size||"None"}),r._ajax1(!1)};(async(e,t)=>{const{signed_init_url:r,fields:{hard_file_size_limit:s}}=t;let o="";const i={"Content-Length":"0","Content-Type":e.type,"x-goog-resumable":"start","Content-Disposition":"inline"};s&&(i["x-upload-content-length"]=e.size);try{const e=await fetch(r,{method:"POST",mode:"cors",headers:i}),{headers:t}=e;o=t.get("Location")||""}catch(n){console.error("Could not create resumable upload URL"),console.error(n)}return{attributes:t,file:e,resumableSessionUri:o,listeners:{},abortController:new AbortController,hardFileSizeLimit:s}})(s,e).then(e=>{const t=e.resumableSessionUri;if(!t||""===t)throw new Error("Cannot perform resumable upload");return r.resumableUpload=e,e}).then(e=>(c(e,"error",(e,t)=>{n(t)}),c(e,"progress",(e,s)=>{r._progress({loaded:s,total:1},t)}),c(e,"completion",()=>{r._completeResumable(i,o)}),e)).then(y).catch(n)}_completeResumable(e,t){const r=this,o=r.file;this.completionXhr=Object(s.a)({url:e,crossDomain:!0,dataType:"json",type:"POST",cache:!1,data:x({completeResumable:!0},t),error(e,s){"abort"!=s&&(w(r.file.type,{action:"completeResumable",userId:t.uploader_id,filename:o.name,maxFileSize:t.max_file_size||"None",fileSize:o.size,statusCode:e.status,readyState:e.readyState}),r._ajax1(!1))},success(e){r._resolve(e),E(o.type)}})}}},1065:function(e,t,r){"use strict";var s=r(260),o=r(2),i=r(1024),n=r(0),a=function(e,t,r,s){var o,i=arguments.length,n=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(i<3?o(n):i>3?o(t,r,n):o(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},l=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)};let c=class extends n.j{constructor(){super(...arguments),this.error="",this.canRetryUpload=!0,this.progress=0}get filename(){var e;return this.name||(null===(e=this.file)||void 0===e?void 0:e.name)||Object(o.b)("Untitled")}get fileUrl(){return this.file?URL.createObjectURL(this.file):""}cancelUpload(){this._uploadJob&&this._uploadJob.cancel(),this.$emit("cancel",this.file)}onDone(){}_onDone(e){Object(s.a)("Uploader","Done"),this.onDone(),this.$emit("done",this.file,e.url)}_onError(e={}){if(e.error==i.a)this.$emit("reject",this.file,{size:!0}),Object(s.a)("Uploader","Reject");else{const e=Object(o.b)("Sorry, there was an error uploading your file.");this.error=e,this.canRetryUpload=!0,Object(s.a)("Uploader","Error"),this.$emit("error",this.file,e)}}onProgress(){}_onProgress(e){this.progress=e,this.onProgress()}startUpload(){this.error="";const e=this._onDone.bind(this),t=this._onError.bind(this),r=this._onProgress.bind(this);this._uploadJob=new i.b(this.file,{maxFileSize:this.maxFileSize}),this._uploadJob.on("done",e),this._uploadJob.on("error",t),this._uploadJob.on("progress",r),this._uploadJob.perform()}mounted(){this.file&&this.startUpload()}beforeDestroy(){this._uploadJob&&this._uploadJob.cancel()}};a([Object(n.h)({default:null}),l("design:type",Object)],c.prototype,"file",void 0),a([Object(n.h)(),l("design:type",String)],c.prototype,"name",void 0),a([Object(n.h)({default:31457280}),l("design:type",Number)],c.prototype,"maxFileSize",void 0),c=a([Object(n.b)({})],c),t.a=c},1170:function(e,t,r){"use strict";var s=r(93),o=r(558),i=r(1065),n={components:{BaseIcon:s.a,ProgressDeterminate:o.a},mixins:[i.a]},a=(r(1405),r(3)),l=Object(a.a)(n,(function(){var e=this._self._c;return e("div",{staticClass:"upload-file"},[e("div",{staticClass:"upload-info"},[e("div",{staticClass:"upload-name ellipsified-type"},[this._v(this._s(this.filename))]),this._v(" "),e("base-icon",{staticClass:"icon-button upload-cancel",attrs:{name:"close"},on:{click:this.cancelUpload}})],1),this._v(" "),e("div",{staticClass:"progress-container"},[e("progress-determinate",{attrs:{progress:this.progress}})],1)])}),[],!1,null,"d1d4e81a",null);t.a=l.exports},1226:function(e,t,r){},1405:function(e,t,r){"use strict";r(1226)},354:function(e,t,r){"use strict";var s=r(73),o=r(0),i=function(e,t,r,s){var o,i=arguments.length,n=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(i<3?o(n):i>3?o(t,r,n):o(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},n=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)};let a=class extends o.j{get processedSrc(){if(this.src.startsWith("/"))return this.src;return Object(s.processedUrl)(this.src,this.transforms)}handleError(e){return e}};i([Object(o.h)({type:String}),n("design:type",String)],a.prototype,"src",void 0),i([Object(o.h)({type:Number}),n("design:type",Number)],a.prototype,"width",void 0),i([Object(o.h)({type:Number}),n("design:type",Number)],a.prototype,"height",void 0),i([Object(o.h)({type:Object}),n("design:type",Object)],a.prototype,"transforms",void 0),i([Object(o.c)("error"),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",void 0)],a.prototype,"handleError",null),a=i([Object(o.b)({})],a);var l=a,c=r(3),p=Object(c.a)(l,(function(){var e=this._self._c;this._self._setupProxy;return this.src?e("img",{attrs:{src:this.processedSrc,width:this.width,height:this.height},on:{error:this.handleError}}):this._e()}),[],!1,null,null,null);t.a=p.exports},558:function(e,t,r){"use strict";var s={props:{progress:{type:Number,default:0}},computed:{progressPercentage:function(){return 100*this.progress+"%"}}},o=r(3),i=Object(o.a)(s,(function(){var e=this._self._c;return e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-determinate",style:{width:this.progressPercentage}})])}),[],!1,null,null,null);t.a=i.exports}}]);
//# sourceMappingURL=15-c3c5ca7e52e18a8731f9.chunk.js.map