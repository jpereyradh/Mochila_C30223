(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[330],{1819:function(e,t,o){"use strict";o.r(t);var i,n=o(68),r=o(1),a=o(0),d=o(53),s=o(67),l=function(e,t,o,i){var n,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(n=e[d])&&(a=(r<3?n(a):r>3?n(t,o,a):n(t,o))||a);return r>3&&a&&Object.defineProperty(t,o,a),a},p=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)};const c=Object(a.m)("draft"),u=Object(a.m)("snackbars"),h=Object(a.m)("composerModal"),f=Object(a.m)("composerModalAlert"),y=Object(a.m)("confirmationDialog"),v=Object(a.m)("dragAndDropEvents"),g=Object(a.m)("post"),b=Object(a.m)("table"),m=Object(a.m)("browser");let A=class extends a.j{constructor(){super(...arguments),this.xBulkActionMenu=!1,this.bulkActionPopoverAnchor={}}get pendingPostReadyToUploadCids(){if(this.isTable)return this.tablePostsToUpload.filter(e=>!!e.file).map(e=>e.cid);const e=this.pendingPosts.filter(e=>!!e.file);if(this.isShelf||this.canUseSections){return e.filter(e=>!!e.wall_section_id).map(e=>e.cid)}return e.map(e=>e.cid)}get isComposerModalExpanded(){return this.isAnyDraftActive&&this.isComposerModalExpandedWhenOpened}respondToNewPendingPostsReadyToUpload(e){0!==e.length&&(e.forEach(e=>{const t=this.pendingPostEntitiesByCid[e];t.file&&this.createNewDraftFromPendingUpload({file:t.file,postAttributes:t})}),this.removePendingPosts({cids:e}))}respondToActiveDraftChanges(e){e&&!Object(s.m)(e)&&this.expandComposerModal()}respondToWindowSizeChanges(){this.updateBulkActionPopoverAnchor()}hideMarginStyle(e){return this.draftCids.length<2?{}:this.isCidActiveDraft(e)&&this.isComposerModalExpandedWhenOpened?{marginRight:"0px"}:{}}uploadingFileByCid(e){var t;return null===(t=this.draftByCid(e))||void 0===t?void 0:t.uploadingFile}maxFileUploadSizeByCid(e){var t;return(null===(t=this.draftByCid(e))||void 0===t?void 0:t.maxFileUploadSize)||this.uploadLimit}onUploadError(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.isCidActiveDraft(o)?this.openAlert({title:this.__("There was an error loading the attachment"),body:t,primaryActionText:this.__("Try again"),secondaryActionText:this.__("Cancel"),primaryActions:[{type:"draft/uploadFileActiveDraft",payload:{file:e,maxFileUploadSize:null===(i=this.draftByCid(o))||void 0===i?void 0:i.maxFileUploadSize}}],secondaryActions:[]}):this.setSnackbar({message:t})}onUploadCancel(e,t){var o;this.stopAutoPublishDraft({cid:t}),(null===(o=this.draftByCid(t))||void 0===o?void 0:o.uploadingFile)&&this.stopUploadFileInDraft({cid:t})}onUploadReject(e,t,o){this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.showOverFileSizeModal({file:e})}onUploadDone(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.updateDraft({cid:o,attachment:t,wish_content:{attachment_props:{url:t},is_processed:!1}}),(null===(i=this.draftByCid(o))||void 0===i?void 0:i.shouldAutoPublish)&&this.savePost({attributes:this.draftByCid(o)})}checkUnsavedDraft(e){if(!this.draftCids.some(e=>{const t=this.draftByCid(e);if(!t)return!1;const o=this.getPostByCid(e),i=Object(s.m)(t)&&Object(s.n)(t),n=!!t.uploadingFile,r=t.subject!==(null===o||void 0===o?void 0:o.subject)||t.body!==(null===o||void 0===o?void 0:o.body)||t.attachment!==(null===o||void 0===o?void 0:o.attachment)||t.attachment_caption!==(null===o||void 0===o?void 0:o.attachment_caption);return i||n||r}))return;const t=this.__("It looks like you have unsaved changes. Are you sure you want to discard them and close this page?");return e.returnValue=t,t}openBulkActionMenu(){this.updateBulkActionPopoverAnchor(),this.xBulkActionMenu=!0}closeBulkActionMenu(){this.xBulkActionMenu=!1}updateBulkActionPopoverAnchor(){const e=this.$refs.bulkActionButton;if(!e)return void(this.bulkActionPopoverAnchor={});const t=e.$el.getBoundingClientRect();this.bulkActionPopoverAnchor={top:t.top,left:t.left,width:t.width,position:"top"}}publishAllDrafts(){this.closeBulkActionMenu();[...this.draftCids].reverse().forEach(e=>{this.publishDraft({cid:e})})}deleteAllDrafts(){this.closeBulkActionMenu(),this.openConfirmationDialog(Object.assign(Object.assign({},n.a),{isCodeProtected:!1,title:this.__("Delete all drafts?"),body:this.__("You can't undo this action."),confirmButtonText:this.__("Delete drafts"),cancelButtonText:this.__("Cancel"),afterConfirmActions:[{type:"draft/deleteAllDrafts"}],buttonScheme:d.a.Danger,forceFullWidthButtons:!0,xShadow:this.isUsingNewSurfaceShadows}))}mounted(){r.a.addEventListener("beforeunload",this.checkUnsavedDraft)}beforeDestroy(){r.a.removeEventListener("beforeunload",this.checkUnsavedDraft)}};l([a.d,p("design:type",Number)],A.prototype,"uploadLimit",void 0),l([a.d,p("design:type",Boolean)],A.prototype,"isShelf",void 0),l([a.d,p("design:type",Boolean)],A.prototype,"isTable",void 0),l([a.d,p("design:type",Boolean)],A.prototype,"canUseSections",void 0),l([a.d,p("design:type",Boolean)],A.prototype,"isUsingNewSurfaceShadows",void 0),l([a.d,p("design:type",Boolean)],A.prototype,"xMobileSurfaceLayoutV3",void 0),l([c.Getter,p("design:type",Object)],A.prototype,"activeDraft",void 0),l([c.Getter,p("design:type",Array)],A.prototype,"draftCids",void 0),l([c.Getter,p("design:type",Function)],A.prototype,"draftByCid",void 0),l([c.Getter,p("design:type",Function)],A.prototype,"isCidActiveDraft",void 0),l([c.Getter,p("design:type",Boolean)],A.prototype,"isAnyDraftActive",void 0),l([c.Getter,p("design:type",Object)],A.prototype,"activeDraftUploadingFile",void 0),l([g.Getter,p("design:type",Array)],A.prototype,"pendingPosts",void 0),l([g.Getter,p("design:type","function"===typeof(i="undefined"!==typeof Record&&Record)?i:Object)],A.prototype,"pendingPostEntitiesByCid",void 0),l([g.Getter,p("design:type",Function)],A.prototype,"getPostByCid",void 0),l([b.Getter("postsPendingUpload"),p("design:type",Array)],A.prototype,"tablePostsToUpload",void 0),l([h.Getter("isExpanded"),p("design:type",Boolean)],A.prototype,"isComposerModalExpandedWhenOpened",void 0),l([v.Getter("isHandlingDragEvent"),p("design:type",Boolean)],A.prototype,"isPageHandlingDragEvent",void 0),l([m.Getter,p("design:type",Number)],A.prototype,"windowWidth",void 0),l([m.Getter,p("design:type",Number)],A.prototype,"windowHeight",void 0),l([a.a,p("design:type",Function)],A.prototype,"showOverFileSizeModal",void 0),l([u.Action,p("design:type",Function)],A.prototype,"setSnackbar",void 0),l([c.Action,p("design:type",Function)],A.prototype,"stopUploadFileInDraft",void 0),l([c.Action,p("design:type",Function)],A.prototype,"updateDraft",void 0),l([c.Action,p("design:type",Function)],A.prototype,"createNewDraftFromPendingUpload",void 0),l([c.Action,p("design:type",Function)],A.prototype,"stopAutoPublishDraft",void 0),l([f.Action,p("design:type",Function)],A.prototype,"openAlert",void 0),l([g.Action,p("design:type",Function)],A.prototype,"removePendingPosts",void 0),l([g.Action,p("design:type",Function)],A.prototype,"savePost",void 0),l([h.Action("expand"),p("design:type",Function)],A.prototype,"expandComposerModal",void 0),l([Object(a.k)("pendingPostReadyToUploadCids"),p("design:type",Function),p("design:paramtypes",[Array]),p("design:returntype",void 0)],A.prototype,"respondToNewPendingPostsReadyToUpload",null),l([Object(a.k)("activeDraft"),p("design:type",Function),p("design:paramtypes",[Object]),p("design:returntype",void 0)],A.prototype,"respondToActiveDraftChanges",null),l([Object(a.k)("windowWidth"),Object(a.k)("windowHeight"),p("design:type",Function),p("design:paramtypes",[]),p("design:returntype",void 0)],A.prototype,"respondToWindowSizeChanges",null),l([c.Action,p("design:type",Function)],A.prototype,"publishDraft",void 0),l([y.Action,p("design:type",Function)],A.prototype,"openConfirmationDialog",void 0),A=l([Object(a.b)({components:{SurfaceComposerModalNew:Object(a.l)(()=>Promise.all([o.e(0),o.e(26),o.e(277),o.e(192)]).then(o.bind(null,1738))),OzBaseButton:Object(a.l)(()=>Promise.resolve().then(o.bind(null,18))),OzIcon:Object(a.l)(()=>Promise.resolve().then(o.bind(null,28))),SurfaceDraftBulkActionPopover:Object(a.l)(()=>o.e(273).then(o.bind(null,1843)))}})],A);var k=A,D=o(3),B=Object(D.a)(k,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{class:["fixed","top-0",e.xMobileSurfaceLayoutV3?"bottom-13":"bottom-0","right-0","left-0","pointer-events-none","inline-flex","items-end","flex-row-reverse","space-s-reverse","space-s-4","z-backdrop","px-8","tablet-landscape:pe-33",e.isPageHandlingDragEvent&&"bg-grape-500 dark:bg-drag-overlay-dark bg-opacity-50 dark:bg-opacity-35"]},[e.draftCids.length>1?t("div",{staticClass:"flex-shrink-0 pointer-events-auto"},[t("OzBaseButton",{ref:"bulkActionButton",class:["h-10","w-10","p-0","grid","place-items-center","rounded-t-xl","text-dark-text-200 dark:text-light-text-200","hover-hover:hover:text-dark-text-100 hover-hover:dark:hover:text-light-text-100","bg-light-ui-100","dark:bg-dark-ui-100","hover-hover:active:text-grape-500 hover-hover:dark:active:text-canary-500","focus:text-grape-500 dark:focus:text-canary-500","focus-visible:ring-[2.5px]","ring-grape-500","dark:ring-canary-500",e.isUsingNewSurfaceShadows&&"shadow-elevation-2"],attrs:{title:e.__("Open drafts bulk action menu"),"aria-label":e.__("Open drafts bulk action menu")},on:{click:e.openBulkActionMenu}},[t("OzIcon",{attrs:{name:"bulk_action",size:24}})],1),e._v(" "),e.xBulkActionMenu?t("SurfaceDraftBulkActionPopover",{attrs:{"popover-anchor":e.bulkActionPopoverAnchor},on:{cancel:e.closeBulkActionMenu,"publish-all":e.publishAllDrafts,"delete-all":e.deleteAllDrafts}}):e._e()],1):e._e(),e._v(" "),e._l(e.draftCids,(function(o){return t("surface-composer-modal-new",{key:o,style:e.hideMarginStyle(o),attrs:{"draft-cid":o,file:e.uploadingFileByCid(o),"max-file-size":e.maxFileUploadSizeByCid(o)},on:{error:(t,i)=>e.onUploadError(t,i,o),cancel:t=>e.onUploadCancel(t,o),done:(t,i)=>e.onUploadDone(t,i,o),reject:(t,i)=>e.onUploadReject(t,i,o)}})}))],2)}),[],!1,null,null,null);t.default=B.exports}}]);
//# sourceMappingURL=330-c4b10610fac2ca39d4e6.chunk.js.map